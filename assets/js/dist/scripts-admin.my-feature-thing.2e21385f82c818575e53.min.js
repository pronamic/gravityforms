"use strict";(self.webpackChunkgravityforms=self.webpackChunkgravityforms||[]).push([[867],{6775:function(e,t,r){r.d(t,{default:function(){return u}});var n=r(455),o=r(9280),a=r.n(o),i=r(3963),c=r.n(i),s=r(5798);function u(){!function(){var e=(0,s.getNodes)("rest-api-add-key")[0];if(!e)return;e.addEventListener("click",function(){var e=function(){var e=(0,s.getNodes)("#gform-webapi-edit-container",!1,document,!0)[0],t=document.createElement("div");t.insertAdjacentHTML("beforeend",e.innerHTML);var r=t.querySelector(".alert");r&&r.remove();t.querySelector("#gform-webapi-key").value=0,t.querySelector("#gform-webapi-description").value="",t.querySelector("#gform-webapi-user").selectedIndex=0,t.querySelector("#gform-webapi-permissions").selectedIndex=0,t.querySelector("#gform-webapi-consumer-key").closest(".gform-input-wrapper").style.display="none",t.querySelector("#gform-webapi-consumer-secret").closest(".gform-input-wrapper").style.display="none",t.querySelector("#gform-webapi-last-access").parentElement.style.display="none";var n=t.querySelector('button[type="submit"]');return n.textContent=n.getAttribute("data-add"),t}();p(wp.i18n.__("Add New Key","gravityforms"),e.innerHTML,"rest-api-add-key-dialog");var t=document.getElementById("rest-api-add-key-dialog"),r=t.querySelector("#gform-webapi-edit");!function(e,t){e.addEventListener("click",function(e){e.target.matches("button[data-add]")&&(e.preventDefault(),y(t,!0).then(function(){l=!0}))})}(t,r)}),document.querySelectorAll(".rest-api-edit-key").forEach(function(e){e.addEventListener("click",function(){var e=(0,n.A)(a().mark(function e(t){var r,n;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),r=(0,s.getNodes)("#gform-webapi-edit-container",!1,document,!0)[0],p(wp.i18n.__("Edit Key","gravityforms"),r.innerHTML,"rest-api-edit-key-dialog"),n=t.target.getAttribute("data-id"),e.next=6,g(n);case 6:d();case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())})}(),function(){var e=document.getElementById("gfwebapi-qrbutton"),t=document.getElementById("gfwebapi-qrcode-container"),r=document.getElementById("gfwebapi-qrcode");e.addEventListener("click",function(e){e.preventDefault(),t.style.display="block"===t.style.display?"none":"block",r&&(r.src="".concat(ajaxurl,"?action=gfwebapi_qrcode&rnd=").concat(Date.now()),r.alt="")});var n=document.getElementById("public_key"),o=document.getElementById("private_key");[n,o].forEach(function(e){e.addEventListener("keyup",function(){t.querySelector(".alert")||(t.innerHTML='<div class="alert warning"> '.concat(wp.i18n.__("Keys have unsaved changes. Please save the changes and try again.","gravityforms")," </div>"))})})}()}var l=!1;function p(e,t,r){new(c())({id:r,title:e,content:t,closeButtonTitle:"Close modal",closeButtonSize:"xs",onClose:function(){l&&document.querySelector("#gform-settings").requestSubmit()},mode:"modal",zIndex:100055}).showDialog()}function d(){var e=document.getElementById("rest-api-edit-key-dialog").querySelector("#gform-webapi-edit");e.addEventListener("click",function(t){t.target.matches("button[data-edit]")&&(t.preventDefault(),y(e,!1).then(function(){l=!0}))})}function y(e){return m.apply(this,arguments)}function m(){return m=(0,n.A)(a().mark(function e(t){var r,n,o,i,c,s,u,p=arguments;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(p.length>1&&void 0!==p[1])||p[1],(n=new FormData).append("action","gfwebapi_edit_key"),n.append("nonce",t.querySelector('input[name="_wpnonce"]').value),n.append("key_id",t.querySelector("#gform-webapi-key").value),n.append("description",t.querySelector("#gform-webapi-description").value),n.append("user_id",t.querySelector("#gform-webapi-user").value),n.append("permissions",t.querySelector("#gform-webapi-permissions").value),e.next=10,fetch(ajaxurl,{method:"POST",body:n});case 10:return o=e.sent,e.next=13,o.json();case 13:if(i=e.sent,(c=t.querySelector(".alert"))&&c.remove(),s=i.success?"success":"error",t.insertAdjacentHTML("afterbegin",'<div class="alert '.concat(s,' "> ').concat(i.data.message," </div>")),i.success){e.next=20;break}return e.abrupt("return");case 20:r&&(t.querySelector("#gform-webapi-description").parentElement.style.display="none",t.querySelector("#gform-webapi-user").parentElement.style.display="none",t.querySelector("#gform-webapi-permissions").parentElement.style.display="none",t.querySelector("button[data-add]").style.display="none",t.querySelector("#gform-webapi-consumer-key").closest(".gform-input-wrapper").style.display="block",t.querySelector("#gform-webapi-consumer-secret").closest(".gform-input-wrapper").style.display="block",t.querySelector("#gform-webapi-consumer-key").value=i.data.key.consumer_key,t.querySelector("#gform-webapi-consumer-secret").value=i.data.key.consumer_secret,f(),(u=t.closest(".gform-dialog"))&&(u.setAttribute("tabindex","-1"),u.style.outline="none",u.focus())),l=!0;case 22:case"end":return e.stop()}},e)})),m.apply(this,arguments)}function f(){document.querySelectorAll(".gform-input__action-wrapper").forEach(function(e){var t=e.querySelector("button"),r=e.querySelector("input"),n=t.querySelector(".gform-button__text");t.addEventListener("click",function(e){e.preventDefault(),r.select(),navigator.clipboard.writeText(r.value),n.textContent=wp.i18n.__("Copied!","gravityforms"),setTimeout(function(){n.textContent=wp.i18n.__("Copy","gravityforms")},7e3)})})}function g(e){return b.apply(this,arguments)}function b(){return(b=(0,n.A)(a().mark(function e(t){var r,n,o,i,c,s,u;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=document.getElementById("rest-api-edit-key-dialog"),(n=r.querySelector("#gform-webapi-edit")).querySelector("#gform-webapi-consumer-key").closest(".gform-input-wrapper").style.display="none",n.querySelector("#gform-webapi-consumer-secret").closest(".gform-input-wrapper").style.display="none",n.querySelector("#gform-webapi-last-access").parentElement.style.display="none",o=document.querySelector('#gform-webapi-edit input[name="_wpnonce"]').value,e.next=8,fetch("".concat(ajaxurl,"?action=gfwebapi_edit_key&key_id=").concat(t,"&nonce=").concat(o),{method:"GET",headers:{"Content-Type":"application/json"}});case 8:return i=e.sent,e.next=11,i.json();case 11:if((c=e.sent).success){e.next=14;break}return e.abrupt("return");case 14:return s=c.data.key,n.querySelector("#gform-webapi-key").value=s.key_id,n.querySelector("#gform-webapi-description").value=s.description,n.querySelector("#gform-webapi-user").selectedIndex=s.userId,n.querySelector("#gform-webapi-permissions").selectedIndex=s.permissions,n.querySelector("#gform-webapi-last-access").parentElement.style.display="block",n.querySelector("#gform-webapi-last-access .gform-status-indicator-status").textContent=s.last_access,(u=r.querySelector('button[type="submit"]')).textContent=u.getAttribute("data-edit"),e.abrupt("return",n);case 24:case"end":return e.stop()}},e)}))).apply(this,arguments)}}}]);